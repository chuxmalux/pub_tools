

{ ``` Powershell ```
# PS enable module logging 
HKLM\SOFTWARE\Wow6432Node\Policies\Microsoft\Windows\PowerShell\ModuleLogging EnableModuleLogging = 1  
HKLM\SOFTWARE\Wow6432Node\Policies\Microsoft\Windows\PowerShell\ModuleLogging\ModuleNames * = *         

# PS enable script block logging
HKLM\SOFTWARE\Wow6432Node\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging EnableScriptBlockLogging = 1         

# PS enable Transcription logging 
HKLM\SOFTWARE\Wow6432Node\Policies\Microsoft\Windows\PowerShell\Transcription EnableTranscription = 1
HKLM\SOFTWARE\Wow6432Node\Policies\Microsoft\Windows\PowerShell\Transcription EnableInvocationHeader = 1
HKLM\SOFTWARE\Wow6432Node\Policies\Microsoft\Windows\PowerShell\TranscriptionOutputDirectory ="" (Enter path. Empty = default)         
}

{ ``` Survey and Triage related ```
# enable last access timestamp on FAT systems by setting to 0, but could bottleneck the I/O queue
HKLM\System\CurrentControlSet\Control\File system\NtfsDisableLastAccessUpdate = 1 # disabled


}

{ ``` Persistence / Malware Checks ```
# Run/RunOnce 
reg query hklm\software\microsoft\windows\currentversion\run &&
reg query hklm\software\microsoft\windows\currentversion\runonce &&
reg query hkcu\software\microsoft\windows\currentversion\run && 
reg query hkcu\software\microsoft\windows\currentversion\runonce 
reg query hklm\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run

# Winlogon - shell = explorer.exe, userinit = userinit.exe. otherwise malware --- also shows default Domain Name and User 
reg query "hklm\software\microsoft\windows nt\currentversion\winlogon

# BootExecute key (value should = autocheck autochk*) 
reg query "HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\Session Manager" &&
reg query "HKEY_LOCAL_MACHINE\SYSTEM\ControlSet002\Control\Session Manager"

# Startup Keys (user/system startup folders) - check & dir
reg query "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" /v Startup &&
reg query "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders" /v Startup &&
reg query  "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders" /v Startup &&
reg query  "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders" /v Startup

# Boot Services 
reg query "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\service"
	reg query "HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce"
	reg query "HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunServices"

# AppInit_DLLs: should DLL be loaded from this key? or from another app
reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Windows /v AppInit_DLLs"

# file renames 
reg query "HKLM\System\CurrentControlSet\Control\Session Manager\FileRenameOperations" 
}